<!DOCTYPE html>
<html>
<head>
  <title>Debug Supabase</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <h1>Test Supabase Direct</h1>
  <button onclick="testSignUp()">Test Inscription</button>
  <div id="results"></div>

  <script>
    const SUPABASE_URL = 'https://qoynvpciuxhipessvojj.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFveW52cGNpdXhoaXBlc3N2b2pqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI5OTgzMjgsImV4cCI6MjA2ODU3NDMyOH0.md1_Pxl8YyUTOxdTzhCNgfiIrQkH-WYTIg7XfblL_z8';
    
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    
    function log(message) {
      document.getElementById('results').innerHTML += '<p>' + JSON.stringify(message) + '</p>';
      console.log(message);
    }
    
    async function testSignUp() {
      document.getElementById('results').innerHTML = '<h2>Test en cours...</h2>';
      
      try {
        // Test 1: Configuration
        log('1. Configuration OK: ' + {
          url: !!SUPABASE_URL,
          key: !!SUPABASE_ANON_KEY
        });
        
        // Test 2: Connexion
        const { data: session, error: sessionError } = await supabase.auth.getSession();
        log('2. Session test: ' + {
          error: sessionError?.message || 'OK',
          hasSession: !!session
        });
        
        // Test 3: Inscription
        const testEmail = `debug_${Date.now()}@test.com`;
        const { data, error } = await supabase.auth.signUp({
          email: testEmail,
          password: 'debug123456'
        });
        
        log('3. Inscription test: ' + {
          success: !error,
          hasUser: !!data?.user,
          userId: data?.user?.id,
          error: error ? {
            message: error.message,
            status: error.status,
            name: error.name
          } : null
        });
        
        // Test 4: Detailed error
        if (error) {
          log('4. Erreur détaillée: ' + {
            type: typeof error,
            keys: Object.keys(error),
            isAuthError: error.__isAuthError,
            stack: error.stack
          });
        }
        
      } catch (exception) {
        log('Exception: ' + exception.message);
      }
    }
  </script>
</body>
</html>