<!DOCTYPE html>
<html>
<head>
    <title>ğŸ” Debug Direct Supabase</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .result { background: #f0f0f0; padding: 10px; margin: 10px 0; border-left: 4px solid #007acc; }
        .error { border-left-color: #dc3545; }
        .success { border-left-color: #28a745; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>ğŸ” Debug Direct - Exactement comme ton code</h1>
    
    <button onclick="testFullFlow()">ğŸ§ª Test Complet (comme ton code)</button>
    <button onclick="testTableAccess()">ğŸ“Š Test AccÃ¨s Table</button>
    <button onclick="testInsert()">â• Test Insert Direct</button>
    <button onclick="clearResults()">ğŸ§¹ Effacer</button>
    
    <div id="results"></div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // EXACTEMENT tes clÃ©s
        const supabaseUrl = 'https://qoynvpciuxhipessvojj.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFveW52cGNpdXhoaXBlc3N2b2pqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI5OTgzMjgsImV4cCI6MjA2ODU3NDMyOH0.md1_Pxl8YyUTOxdTzhCNgfiIrQkH-WYTIg7XfblL_z8';
        
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = new Date().toLocaleTimeString() + ' - ' + message;
            document.getElementById('results').appendChild(div);
            console.log(message);
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
        
        async function testTableAccess() {
            log('ğŸ“Š Test accÃ¨s table agents...', 'info');
            
            try {
                const { data, error, count } = await supabase
                    .from('agents')
                    .select('*', { count: 'exact' })
                    .limit(5);
                
                if (error) {
                    log('âŒ ERREUR accÃ¨s table: ' + error.message + ' (Code: ' + error.code + ')', 'error');
                    log('ğŸ” DÃ©tails: ' + JSON.stringify(error, null, 2), 'error');
                    return false;
                }
                
                log('âœ… Table accessible - ' + (count || 0) + ' agents trouvÃ©s', 'success');
                if (data && data.length > 0) {
                    log('ğŸ“‹ Colonnes: ' + Object.keys(data[0]).join(', '), 'info');
                }
                return true;
                
            } catch (err) {
                log('ğŸ’¥ Exception: ' + err.message, 'error');
                return false;
            }
        }
        
        async function testInsert() {
            log('â• Test insertion directe...', 'info');
            
            const testAgent = {
                name: 'Test Debug Direct',
                identifier: 'debug_' + Date.now(),
                phone_number: '+33123456789',
                email: 'test@debug.com',
                website_url: 'https://debug.com',
                platform: 'whatsapp',
                category: 'other',
                status: 'active',
                description: 'Agent de debug',
                about_description: 'Test debug',
                internal_notes: 'Notes debug',
                full_name: 'Agent Debug Complet'
            };
            
            log('ğŸ“¤ DonnÃ©es Ã  insÃ©rer: ' + JSON.stringify(testAgent, null, 2), 'info');
            
            try {
                const { data, error } = await supabase
                    .from('agents')
                    .insert([testAgent])
                    .select()
                    .single();
                
                if (error) {
                    log('âŒ ERREUR insertion: ' + error.message, 'error');
                    log('ğŸ” Code erreur: ' + error.code, 'error');
                    log('ğŸ” DÃ©tails: ' + JSON.stringify(error, null, 2), 'error');
                    return false;
                }
                
                log('âœ… Agent crÃ©Ã© avec succÃ¨s! ID: ' + data.id, 'success');
                log('ğŸ“„ DonnÃ©es crÃ©Ã©es: ' + JSON.stringify(data, null, 2), 'success');
                
                // Nettoyer
                await supabase.from('agents').delete().eq('id', data.id);
                log('ğŸ§¹ Agent test supprimÃ©', 'info');
                
                return true;
                
            } catch (err) {
                log('ğŸ’¥ Exception insertion: ' + err.message, 'error');
                return false;
            }
        }
        
        async function testFullFlow() {
            log('ğŸš€ === TEST COMPLET COMME TON CODE ===', 'info');
            
            // 1. Test connexion
            log('1ï¸âƒ£ Test connexion Supabase...', 'info');
            try {
                const { error } = await supabase.from('agents').select('count', { count: 'exact', head: true });
                if (error) {
                    log('âŒ Connexion Ã©chouÃ©e: ' + error.message, 'error');
                    return;
                }
                log('âœ… Connexion OK', 'success');
            } catch (err) {
                log('ğŸ’¥ Connexion impossible: ' + err.message, 'error');
                return;
            }
            
            // 2. Test accÃ¨s table
            log('2ï¸âƒ£ Test accÃ¨s table...', 'info');
            const tableOK = await testTableAccess();
            if (!tableOK) {
                log('âŒ Impossible d\'accÃ©der Ã  la table agents', 'error');
                return;
            }
            
            // 3. Test insertion
            log('3ï¸âƒ£ Test insertion...', 'info');
            const insertOK = await testInsert();
            if (!insertOK) {
                log('âŒ Insertion Ã©chouÃ©e', 'error');
                return;
            }
            
            log('ğŸ‰ === TEST COMPLET RÃ‰USSI ===', 'success');
            log('âœ… Si ce test marche mais ton site non, le problÃ¨me est dans ton code React!', 'success');
        }
        
        // Auto-test au chargement
        window.onload = function() {
            log('ğŸš€ Page chargÃ©e - PrÃªt pour les tests', 'info');
        };
    </script>
</body>
</html>